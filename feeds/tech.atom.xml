<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Liuw's Thinkpad</title><link href="http://blog.liuw.name/" rel="alternate"></link><link href="http://blog.liuw.name/feeds/tech.atom.xml" rel="self"></link><id>http://blog.liuw.name/</id><updated>2014-05-05T23:40:00+01:00</updated><entry><title>Fix Debian Wheezy's Openswan Regression with Apple Devices</title><link href="http://blog.liuw.name/fix-debian-wheezys-openswan-regression-with-apple-devices.html" rel="alternate"></link><updated>2014-05-05T23:40:00+01:00</updated><author><name>Wei Liu</name></author><id>tag:blog.liuw.name,2014-05-05:fix-debian-wheezys-openswan-regression-with-apple-devices.html</id><summary type="html">&lt;p&gt;In late March Debian Security team pushed a security update to Openswan package in Wheezy. My Macbook Air cannot connect to Openswan anymore after upgrading.&lt;/p&gt;
&lt;p&gt;I searched a bit and found out that somebody already filed a bug report on Debian bug tracker: &lt;a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=744717"&gt; bug 744717 &lt;/a&gt;. There's also a report on Openswan's Github page to confirm this bug: &lt;a href="https://github.com/xelerance/Openswan/issues/78"&gt;issue 78&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;On Debian bug tracker a user named Liu DongMiao provided a patch and it was reported to work. I had a look at that patch but didn't quite like it, because it leaked a macro in C file, which is not a proper fix to me.&lt;/p&gt;
&lt;p&gt;The root cause of the problem is confilict in header file. Debian Security team removed ISAKMP_NEXT_NATD_BADDRAFTS. Then they had to comment out or remove some code to handle that flag, of which Apple devices make use. Unfortunately I cannot get Apple to fix their code so I have to fix mine.&lt;/p&gt;
&lt;p&gt;The fix is simplier than I thought. I compared upstream Openswan 2.6.37 with Wheezy's patched version, then restored the original flag and those code snippets. I was worried that the overriden new flag was used in code but it wasn't. I didn't touch changelog or version number of that package, so that when a new package is out it can be automatically updated when the maintainers push a new package to fix that bug.&lt;/p&gt;
&lt;p&gt;I have my &lt;a href="../files/fix-osx-baddraft-flag.patch"&gt;patch&lt;/a&gt; attached. If you want to know how to rebuild Debian package, &lt;a href="https://www.debian.org/doc/manuals/maint-guide/index.en.html"&gt;Debian New Maintainers' Guide&lt;/a&gt; is a good starting point.&lt;/p&gt;</summary></entry></feed>